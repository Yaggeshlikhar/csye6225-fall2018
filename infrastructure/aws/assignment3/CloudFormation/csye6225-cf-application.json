{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description" : "Application-Infrastructure",
  "Parameters":{
     "Vpcid":{
         "Type":"AWS::EC2::VPC::Id"
  },
   "subnetId":{
         "Type":"String"
  }
},

"Resources":{
    "InstanceSecurityGroup":{
      "Type" : "AWS::EC2::SecurityGroup",
      "Properties" : {
         
         "GroupDescription":"client host",
         "SecurityGroupIngress" : [ {
          "IpProtocol" : "tcp",
                "FromPort" : "80",
                "ToPort" : "80",
                "CidrIp" : "0.0.0.0/0"
         },
         {
                "IpProtocol" : "tcp",
                "FromPort" : "22",
                "ToPort" : "22",
                "CidrIp" : "0.0.0.0/0"},
          {
                "IpProtocol" : "tcp",
                "FromPort" : "443",
                "ToPort" : "443",
                "CidrIp" : "0.0.0.0/0"}              

],
         "Tags" :  [ {"Key":"Name",
                      "Value":"csye6225-web"} ],
         "VpcId" : {"Ref":"Vpcid"}
      }
    },

    "DBSecurityGroup" : {
    "Type" : "AWS::EC2::SecurityGroup",
    "Properties" : {
       "GroupDescription" : "Allow http to client host",
       "VpcId" : {"Ref" : "Vpcid"},
       "Tags": [{"Key":"Name","Value":"csye6225-rds"}],
       "SecurityGroupIngress" : [{
             "IpProtocol" : "tcp",
             "FromPort" : 3306,
             "ToPort" : 3306,
             "SourceSecurityGroupId" : { "Ref": "InstanceSecurityGroup"}
          }]
    }
 },
      "MyEC2Instance" : {
         "Type" : "AWS::EC2::Instance",
         "Properties" : {
            "ImageId" : "ami-9887c6e7",
            
            "InstanceType":"t2.micro",
            
            "SecurityGroupIds":[{"Ref":"InstanceSecurityGroup"}],
            "SubnetId":{"Ref":"subnetId"},
            "BlockDeviceMappings" : [
               {
                  "DeviceName" : "/dev/sdm",
                  "Ebs" : {
                     "VolumeType" : "io1",
                     "Iops" : "200",
                     "DeleteOnTermination" : "false",
                     "VolumeSize" : "20"
                     
                  }
               },
               {
                  "DeviceName" : "/dev/sdk",
                  "NoDevice" : {}
               }
            ]
            
         }
      }

   
     
      

  }
}
